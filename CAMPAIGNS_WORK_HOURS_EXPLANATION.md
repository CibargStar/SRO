# –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–∞–º–ø–∞–Ω–∏–∏ –¥–ª—è —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤

## üìã –û–±–∑–æ—Ä

–í —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å –¥–≤–∞ —É—Ä–æ–≤–Ω—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤:

1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (ROOT)** - `CampaignGlobalSettings`
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏–π
   - –•—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `CampaignGlobalSettings`

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏** - `ScheduleConfig` –≤ –ø–æ–ª–µ `campaign.scheduleConfig`
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
   - –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —ç—Ç–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
   - –•—Ä–∞–Ω—è—Ç—Å—è –≤ JSON –ø–æ–ª–µ `scheduleConfig` —Ç–∞–±–ª–∏—Ü—ã `Campaign`

---

## üîç –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (ROOT)

**–ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è:**
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `/api/admin/campaigns/settings` (PUT)
- –î–æ—Å—Ç—É–ø: —Ç–æ–ª—å–∫–æ ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**–ü–æ–ª—è:**
```typescript
{
  defaultWorkHoursStart: "09:00",  // –§–æ—Ä–º–∞—Ç HH:mm
  defaultWorkHoursEnd: "21:00",     // –§–æ—Ä–º–∞—Ç HH:mm
  defaultWorkDays: [1, 2, 3, 4, 5]  // –ú–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª 1-7 (–ü–Ω-–í—Å)
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –µ—Å–ª–∏ –≤ –∫–∞–º–ø–∞–Ω–∏–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –∫–∞–º–ø–∞–Ω–∏—è–º, —É –∫–æ—Ç–æ—Ä—ã—Ö `workHoursEnabled=false` –∏–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã `workHoursStart/workHoursEnd`

---

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏

**–ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞–º–ø–∞–Ω–∏–∏: `POST /api/campaigns` (–≤ `scheduleConfig`)
- –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: `PATCH /api/campaigns/:id` (–≤ `scheduleConfig`)
- –î–æ—Å—Ç—É–ø: –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Å–≤–æ–∏—Ö –∫–∞–º–ø–∞–Ω–∏–π

**–ü–æ–ª—è:**
```typescript
{
  workHoursEnabled: boolean,        // –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è —ç—Ç–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
  workHoursStart?: "09:00",         // –§–æ—Ä–º–∞—Ç HH:mm (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  workHoursEnd?: "21:00",           // –§–æ—Ä–º–∞—Ç HH:mm (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  workDaysEnabled: boolean,          // –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –¥–ª—è —ç—Ç–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
  workDays?: [1, 2, 3, 4, 5],       // –ú–∞—Å—Å–∏–≤ 0-6 (–í—Å-–°–±) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  timezone?: "Europe/Moscow"        // –¢–∞–π–º–∑–æ–Ω–∞ –¥–ª—è —ç—Ç–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π

---

## ‚öôÔ∏è –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

–õ–æ–≥–∏–∫–∞ –≤ `CampaignSchedulerService.isWithinWorkHours()`:

```typescript
// 1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏
const workHoursStart =
  scheduleConfig?.workHoursStart ??                    // –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ –≤ –∫–∞–º–ø–∞–Ω–∏–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º
  this.parseHour(globalSettings?.defaultWorkHoursStart ?? '09:00'); // –ò–Ω–∞—á–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ, –∏–Ω–∞—á–µ –¥–µ—Ñ–æ–ª—Ç

const workHoursEnd =
  scheduleConfig?.workHoursEnd ??                      // –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ –≤ –∫–∞–º–ø–∞–Ω–∏–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º
  this.parseHour(globalSettings?.defaultWorkHoursEnd ?? '21:00');     // –ò–Ω–∞—á–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ, –∏–Ω–∞—á–µ –¥–µ—Ñ–æ–ª—Ç

const workDays =
  scheduleConfig?.workDays ??                          // –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ –≤ –∫–∞–º–ø–∞–Ω–∏–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º
  globalSettings?.defaultWorkDays ??                   // –ò–Ω–∞—á–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ
  [1, 2, 3, 4, 5];                                     // –ò–Ω–∞—á–µ –¥–µ—Ñ–æ–ª—Ç (–ü–Ω-–ü—Ç)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏** (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω—ã) - –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
2. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** (–µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã –≤ –∫–∞–º–ø–∞–Ω–∏–∏) - —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
3. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** (–µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–¥–∞–Ω–æ) - –Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –§–ª–∞–≥–∏ `workHoursEnabled` –∏ `workDaysEnabled` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è!

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –í —Å—Ö–µ–º–µ `scheduleConfigSchema` –µ—Å—Ç—å —Ñ–ª–∞–≥–∏ `workHoursEnabled` –∏ `workDaysEnabled`
- –≠—Ç–∏ —Ñ–ª–∞–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- **–ù–û** –≤ –ª–æ–≥–∏–∫–µ `isWithinWorkHours()` —ç—Ç–∏ —Ñ–ª–∞–≥–∏ **–ù–ï –ü–†–û–í–ï–†–Ø–Æ–¢–°–Ø**!

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ï—Å–ª–∏ `workHoursEnabled=false`, –Ω–æ –∑–∞–¥–∞–Ω—ã `workHoursStart` –∏ `workHoursEnd`, –æ–Ω–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
- –ï—Å–ª–∏ `workDaysEnabled=false`, –Ω–æ –∑–∞–¥–∞–Ω—ã `workDays`, –æ–Ω–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
- –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è –∫–∞–º–ø–∞–Ω–∏–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ï—Å–ª–∏ `workHoursEnabled=false` ‚Üí —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è (–≤—Å–µ–≥–¥–∞ `true`)
- –ï—Å–ª–∏ `workDaysEnabled=false` ‚Üí —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è (–≤—Å–µ–≥–¥–∞ `true`)
- –ï—Å–ª–∏ –æ–±–∞ `false` ‚Üí –∫–∞–º–ø–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `isWithinWorkHours()`:

```typescript
isWithinWorkHours(
  scheduleConfig: ScheduleConfig | null,
  date: Date,
  globalSettings?: GlobalSettings | null
): boolean {
  // –ï—Å–ª–∏ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ –∫–∞–º–ø–∞–Ω–∏–∏ - –≤—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ–º
  if (scheduleConfig?.workHoursEnabled === false) {
    return true;
  }

  // –ï—Å–ª–∏ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ –∫–∞–º–ø–∞–Ω–∏–∏ - –≤—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∞–µ–º
  if (scheduleConfig?.workDaysEnabled === false) {
    return true;
  }

  const timezone = scheduleConfig?.timezone ?? 'UTC';

  // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã
  if (scheduleConfig?.workHoursEnabled === true) {
    const workHoursStart = scheduleConfig?.workHoursStart 
      ? this.parseHour(scheduleConfig.workHoursStart)
      : this.parseHour(globalSettings?.defaultWorkHoursStart ?? '09:00');
    const workHoursEnd = scheduleConfig?.workHoursEnd
      ? this.parseHour(scheduleConfig.workHoursEnd)
      : this.parseHour(globalSettings?.defaultWorkHoursEnd ?? '21:00');

    const localTime = this.getLocalTime(date, timezone);
    const currentHour = localTime.getHours();

    if (currentHour < workHoursStart || currentHour >= workHoursEnd) {
      return false;
    }
  }

  // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã
  if (scheduleConfig?.workDaysEnabled === true) {
    const workDays = scheduleConfig?.workDays 
      ?? globalSettings?.defaultWorkDays 
      ?? [1, 2, 3, 4, 5];

    const localTime = this.getLocalTime(date, timezone);
    const currentDay = localTime.getDay();

    if (!workDays.includes(currentDay)) {
      return false;
    }
  }

  return true;
}
```

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏ |
|----------|---------------------|-------------------|
| **–ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è** | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (ROOT) | –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–∞–º–ø–∞–Ω–∏–∏ |
| **–ö—Ç–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç** | ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –í–ª–∞–¥–µ–ª–µ—Ü –∫–∞–º–ø–∞–Ω–∏–∏ |
| **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ** | –ö–æ –≤—Å–µ–º –∫–∞–º–ø–∞–Ω–∏—è–º (–µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ) | –¢–æ–ª—å–∫–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏ |
| **–§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏** | `"HH:mm"` (—Å—Ç—Ä–æ–∫–∞) | `"HH:mm"` (—Å—Ç—Ä–æ–∫–∞) |
| **–§–æ—Ä–º–∞—Ç –¥–Ω–µ–π** | `[1,2,3,4,5]` (1-7, –ü–Ω-–í—Å) | `[0,1,2,3,4,5,6]` (0-6, –í—Å-–°–±) |
| **–§–ª–∞–≥–∏ –≤–∫–ª—é—á–µ–Ω–∏—è** | –ù–µ—Ç (–≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç) | `workHoursEnabled`, `workDaysEnabled` |
| **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç** | –ù–∏–∑–∫–∏–π (fallback) | –í—ã—Å–æ–∫–∏–π (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç) |

---

## üéØ –ò—Ç–æ–≥

**–†–∞–∑–Ω–∏—Ü–∞:**
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** = –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∫–∞–º–ø–∞–Ω–∏–π
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏** = –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –§–ª–∞–≥–∏ `workHoursEnabled` –∏ `workDaysEnabled` –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥–∏–∫–µ
- –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è –∫–∞–º–ø–∞–Ω–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `isWithinWorkHours()` –¥–ª—è —É—á–µ—Ç–∞ —Ñ–ª–∞–≥–æ–≤ `workHoursEnabled` –∏ `workDaysEnabled`




