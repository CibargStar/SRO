/**
 * Zod схемы валидации для управления пользователями
 * 
 * Схемы валидации для форм создания и редактирования пользователей на фронтенде.
 * Соответствуют backend схемам для консистентности.
 */

import { z } from 'zod';

/**
 * Схема валидации для создания пользователя
 * 
 * @property email - Email пользователя (валидный email, не пустой, уникальный)
 * @property password - Пароль пользователя (строка, не пустая, минимум 12 символов)
 * @property name - Имя пользователя (опционально, строка, нормальная длина)
 */
export const createUserSchema = z.object({
  email: z
    .string({ required_error: 'Email обязателен' })
    .min(1, { message: 'Email не может быть пустым' })
    .email({ message: 'Неверный формат email' })
    .toLowerCase() // Нормализация email
    .trim(), // Удаляем пробелы

  password: z
    .string({ required_error: 'Пароль обязателен' })
    .min(1, { message: 'Пароль не может быть пустым' })
    .min(12, { message: 'Пароль должен содержать минимум 12 символов' })
    .regex(/[A-Z]/, { message: 'Пароль должен содержать хотя бы одну заглавную букву' })
    .regex(/[a-z]/, { message: 'Пароль должен содержать хотя бы одну строчную букву' })
    .regex(/[0-9]/, { message: 'Пароль должен содержать хотя бы одну цифру' })
    .regex(/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/, {
      message: 'Пароль должен содержать хотя бы один специальный символ',
    }),

  name: z
    .string()
    .min(1, { message: 'Имя не может быть пустым, если указано' })
    .max(100, { message: 'Имя не должно превышать 100 символов' })
    .trim()
    .optional(),
});

/**
 * Тип для данных создания пользователя
 */
export type CreateUserFormData = z.infer<typeof createUserSchema>;

/**
 * Схема валидации для обновления пользователя
 * 
 * Все поля опциональны - можно обновлять только нужные поля.
 * Хотя бы одно поле должно быть предоставлено.
 * 
 * @property email - Email пользователя (опционально, валидный email)
 * @property password - Пароль пользователя (опционально, минимум 12 символов)
 * @property name - Имя пользователя (опционально, строка)
 * @property isActive - Активен ли пользователь (опционально, boolean)
 */
export const updateUserSchema = z
  .object({
    email: z
      .string()
      .min(1, { message: 'Email не может быть пустым, если указан' })
      .email({ message: 'Неверный формат email' })
      .toLowerCase() // Нормализация email
      .trim()
      .optional(),

    password: z
      .string()
      .min(1, { message: 'Пароль не может быть пустым, если указан' })
      .min(12, { message: 'Пароль должен содержать минимум 12 символов' })
      .regex(/[A-Z]/, { message: 'Пароль должен содержать хотя бы одну заглавную букву' })
      .regex(/[a-z]/, { message: 'Пароль должен содержать хотя бы одну строчную букву' })
      .regex(/[0-9]/, { message: 'Пароль должен содержать хотя бы одну цифру' })
      .regex(/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/, {
        message: 'Пароль должен содержать хотя бы один специальный символ',
      })
      .optional(),

    name: z
      .string()
      .min(1, { message: 'Имя не может быть пустым, если указано' })
      .max(100, { message: 'Имя не должно превышать 100 символов' })
      .trim()
      .optional(),

    isActive: z.boolean().optional(),
  })
  .refine(
    (data) => {
      // Проверка: хотя бы одно поле должно быть предоставлено
      return Object.keys(data).length > 0;
    },
    {
      message: 'Хотя бы одно поле должно быть заполнено для обновления',
      path: ['root'],
    }
  );

/**
 * Тип для данных обновления пользователя
 */
export type UpdateUserFormData = z.infer<typeof updateUserSchema>;

