# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Node.js 20, TypeScript 5.9, Express 5, Prisma 6.

**–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ù–µ—Ç —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ root —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –î–≤–µ —Ä–æ–ª–∏: ROOT (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä) –∏ USER (–æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- Root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ root

---

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π –∏ –ø–∞–ø–æ–∫

### 1.1. –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/src/
‚îú‚îÄ‚îÄ modules/                    # –ë–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ auth/                   # –ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts  # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (login, refresh, logout)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.schemas.ts      # Zod —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (login, refresh)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ password.service.ts  # –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (argon2id)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ token.service.ts     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ensureRootUser.ts    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.e2e.spec.ts     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/             # –ü—É–±–ª–∏—á–Ω—ã–π API —Å—Ö–µ–º
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts            # –ü—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ users/                  # –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ       ‚îú‚îÄ‚îÄ users.controller.ts # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (CRUD –¥–ª—è ROOT)
‚îÇ       ‚îú‚îÄ‚îÄ user.schemas.ts      # Zod —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (create, update)
‚îÇ       ‚îú‚îÄ‚îÄ users.e2e.spec.ts    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ schemas/             # –ü—É–±–ª–∏—á–Ω—ã–π API —Å—Ö–µ–º
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ       ‚îî‚îÄ‚îÄ index.ts            # –ü—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è
‚îÇ
‚îú‚îÄ‚îÄ middleware/                # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ middleware
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts                 # Auth middleware (authMiddleware, requireAuth, requireRoot)
‚îÇ   ‚îú‚îÄ‚îÄ security.ts             # Helmet, CORS, rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ zodValidate.ts           # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ Zod
‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.ts          # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ logger.ts                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ notFound.ts              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 404
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                 # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö middleware
‚îÇ
‚îú‚îÄ‚îÄ routes/                     # Express –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.ts           # –ú–∞—Ä—à—Ä—É—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (/api/auth/*)
‚îÇ   ‚îú‚îÄ‚îÄ users.routes.ts          # –ú–∞—Ä—à—Ä—É—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (/api/users/*)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                 # –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
‚îÇ
‚îú‚îÄ‚îÄ config/                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ env.ts                   # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (Zod)
‚îÇ   ‚îú‚îÄ‚îÄ database.ts              # Prisma Client
‚îÇ   ‚îú‚îÄ‚îÄ logger.ts                # Winston logger
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                 # –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ tests/                      # –¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ setup.ts                 # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ utils/                   # –¢–µ—Å—Ç–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ testApp.ts           # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ testDb.ts            # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îî‚îÄ‚îÄ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
‚îÇ
‚îî‚îÄ‚îÄ index.ts                     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

### 1.2. –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:**
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å (auth, users) —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- –ú–æ–¥—É–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–π API —á–µ—Ä–µ–∑ `index.ts`
- –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è —Å–∫—Ä—ã—Ç–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- **Controllers** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Services** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ Prisma
- **Routes** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ Express (–≤ `src/routes/`)
- **Schemas** - Zod —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª–µ–π)
- **Middleware** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–≤ `src/middleware/`)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è:**
- –§–∞–π–ª—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤, —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Å—Ö–µ–º –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è
- –ü—É–±–ª–∏—á–Ω—ã–π API —á–µ—Ä–µ–∑ `index.ts`
- –¢–µ—Å—Ç—ã —Ä—è–¥–æ–º —Å –∫–æ–¥–æ–º (`.e2e.spec.ts`)

---

## 2. –°—É—â–Ω–æ—Å—Ç–∏ –∏ —Ä–æ–ª–∏

### 2.1. Prisma Schema

```prisma
// –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
enum UserRole {
  ROOT  // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ env)
  USER  // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Å–æ–∑–¥–∞–µ—Ç—Å—è root'–æ–º)
}

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
model User {
  id        String    @id @default(uuid())
  email     String    @unique
  passwordHash   String    // –•–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å (argon2id)
  role      UserRole  @default(USER)
  name      String?   // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏–º—è
  isActive  Boolean   @default(true)  // –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω root'–æ–º
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  // –°–≤—è–∑—å —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏
  refreshTokens RefreshToken[]
  
  @@index([email])
  @@index([role])
}

// Refresh —Ç–æ–∫–µ–Ω (–¥–ª—è –æ—Ç–∑—ã–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤)
model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique  // JWT refresh token
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([expiresAt])  // –î–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
  @@index([token])      // –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç–æ–∫–µ–Ω–∞
  @@map("refresh_tokens")
}
```

### 2.2. Enum —Ä–æ–ª–µ–π

**–§–∞–π–ª: `prisma/schema.prisma`**

```prisma
enum UserRole {
  ROOT  // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã
  USER  // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –í Prisma schema (enum)
- –í TypeScript —Ç–∏–ø–∞—Ö (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è Prisma Client)
- –í middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (`requireRoot`)
- –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π

### 2.3. –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞

| –î–µ–π—Å—Ç–≤–∏–µ | ROOT | USER |
|----------|------|------|
| –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É | ‚úÖ | ‚úÖ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è | ‚úÖ | ‚úÖ |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è | ‚ùå | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚úÖ | ‚ùå |
| –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |
| –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |
| –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |

**–í–∞–∂–Ω–æ:**
- ROOT –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é —Ä–æ–ª—å –Ω–∞ USER
- ROOT –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–µ–±—è
- ROOT –Ω–µ –º–æ–∂–µ—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è
- USER –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–ª—å–∫–æ ROOT)

---

## 3. –°—Ö–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT)

### 3.1. –¢–∏–ø—ã —Ç–æ–∫–µ–Ω–æ–≤

#### Access Token (–∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π)
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 15 –º–∏–Ω—É—Ç (–∏–∑ `JWT_ACCESS_EXPIRES_IN`)
- **Payload:**
  ```typescript
  {
    userId: string;      // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    role: UserRole;       // ROOT –∏–ª–∏ USER
    type: 'access';      // –¢–∏–ø —Ç–æ–∫–µ–Ω–∞
    iat: number;         // –í—Ä–µ–º—è –≤—ã–¥–∞—á–∏
    exp: number;         // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
  }
  ```
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í –ø–∞–º—è—Ç–∏ React (—á–µ—Ä–µ–∑ React Query/Zustand) –∏–ª–∏ localStorage
- **–ü–µ—Ä–µ–¥–∞—á–∞:** –í HTTP –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º API endpoints

#### Refresh Token (–¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π)
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 7 –¥–Ω–µ–π (–∏–∑ `JWT_REFRESH_EXPIRES_IN`)
- **Payload:**
  ```typescript
  {
    userId: string;      // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    tokenId: string;     // UUID refresh —Ç–æ–∫–µ–Ω–∞ –≤ –ë–î (–¥–ª—è –æ—Ç–∑—ã–≤–∞)
    type: 'refresh';      // –¢–∏–ø —Ç–æ–∫–µ–Ω–∞
    iat: number;         // –í—Ä–µ–º—è –≤—ã–¥–∞—á–∏
    exp: number;         // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
  }
  ```
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ (body) –∏–ª–∏ –ø–∞–º—è—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞
- **–ü–µ—Ä–µ–¥–∞—á–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∫–∞–∂–¥—ã–º HTTP –∑–∞–ø—Ä–æ—Å–æ–º
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–∞ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞

### 3.2. –†–µ—à–µ–Ω–∏–µ: Cookie vs Header

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

| –¢–æ–∫–µ–Ω | –•—Ä–∞–Ω–µ–Ω–∏–µ (Frontend) | –ü–µ—Ä–µ–¥–∞—á–∞ | –ü—Ä–∏—á–∏–Ω–∞ |
|-------|----------|----------|---------|
| **Access Token** | Zustand store + localStorage (persist) | `Authorization: Bearer <token>` header | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –ª–µ–≥–∫–æ –æ—Ç–æ–∑–≤–∞—Ç—å |
| **Refresh Token** | Zustand store + localStorage (persist) | –í —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ (body) | –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∫–ª–∏–µ–Ω—Ç–∞ |

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Access token –≤ header - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –ª–µ–≥–∫–æ –æ—Ç–æ–∑–≤–∞—Ç—å
- Refresh token –≤ body - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ cookies
- –£–¥–æ–±–Ω–æ –¥–ª—è SPA (React)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (localStorage)

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Frontend):**
- –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage —Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º —Ä–∏—Å–∫–æ–≤ XSS (—Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `frontend/src/store/authStore.ts`)
- –ü—Ä–∏ –ª—é–±–æ–º 401 - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ auth store –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
- Frontend –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- Frontend –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ httpOnly cookie –¥–ª—è refresh token –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã –æ—Ç XSS.

### 3.3. Flow –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```
1. –í—Ö–æ–¥ (POST /api/auth/login)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ email/password
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Access Token (15 –º–∏–Ω)
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Refresh Token (7 –¥–Ω–µ–π)
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Refresh Token –≤ –ë–î
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç Refresh Token –≤ response body
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç Access Token –≤ response body

2. –ó–∞–ø—Ä–æ—Å –∫ API (GET /api/users)
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Access Token –∏–∑ Authorization header
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è Access Token
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (middleware)
   ‚îî‚îÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞

3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (POST /api/auth/refresh)
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Refresh Token –∏–∑ body
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è Refresh Token
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤ –ë–î (–Ω–µ –æ—Ç–æ–∑–≤–∞–Ω)
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ Access Token
   ‚îú‚îÄ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ä–æ—Ç–∞—Ü–∏—è Refresh Token
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç –Ω–æ–≤–æ–≥–æ Access Token

4. –í—ã—Ö–æ–¥ (POST /api/auth/logout)
   ‚îú‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ Refresh Token –∏–∑ –ë–î
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç 204 No Content
```

---

## 4. API Endpoints

### 4.1. Auth Endpoints

```
POST   /api/auth/login          # –í—Ö–æ–¥ (email, password) ‚Üí { accessToken, refreshToken, user }
POST   /api/auth/logout         # –í—ã—Ö–æ–¥ (refreshToken –≤ body) ‚Üí 204
POST   /api/auth/refresh        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (refreshToken –≤ body) ‚Üí { accessToken, refreshToken }
```

**Middleware:**
- `/api/auth/login` - `authRateLimiter` (5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç) + `validateBody(loginSchema)`
- `/api/auth/refresh` - `validateBody(refreshSchema)`
- `/api/auth/logout` - `validateBody(refreshSchema)`

### 4.2. Users Endpoints

```
GET    /api/users/me            # –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ç—Ä–µ–±—É–µ—Ç auth) ‚Üí { user }
GET    /api/users               # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { users[] }
POST   /api/users               # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { user } (201)
PATCH  /api/users/:id           # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { user }
```

**Middleware:**
- `/api/users/me` - `authMiddleware` + `requireAuth`
- `/api/users` (GET, POST) - `authMiddleware` + `requireAuth` + `requireRoot`
- `/api/users/:id` (PATCH) - `authMiddleware` + `requireAuth` + `requireRoot` + `validateBody(updateUserSchema)`

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å ROOT —á–µ—Ä–µ–∑ API (–≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å role: USER)
- –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å ROOT —á–µ—Ä–µ–∑ API (403)
- –ù–µ–ª—å–∑—è –æ–±–Ω–æ–≤–∏—Ç—å role –Ω–∞ ROOT (403)

---

## 5. Security-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

### 5.1. Rate Limiting

**–û–±—â–∏–π rate limiter (—É–∂–µ –µ—Å—Ç—å):**
- 100 –∑–∞–ø—Ä–æ—Å–æ–≤ / 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP

**–°—Ç—Ä–æ–≥–∏–π rate limiter –¥–ª—è `/api/auth/login`:**
- 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP
- –ó–∞—â–∏—Ç–∞ –æ—Ç brute force –∞—Ç–∞–∫
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429 Too Many Requests

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// src/middleware/rate-limit/auth-rate-limit.ts
export const authRateLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,  // 15 –º–∏–Ω—É—Ç
  max: 5,                     // 5 –ø–æ–ø—ã—Ç–æ–∫
  message: 'Too many login attempts, please try again later.',
  standardHeaders: true,
  legacyHeaders: false,
});
```

### 5.2. –ó–∞—â–∏—Ç–∞ –æ—Ç brute force

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (—É—Å–ø–µ—à–Ω—ã—Ö –∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP –ø–æ—Å–ª–µ 10 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ 1 —á–∞—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ Redis)
- CAPTCHA –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 5.3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç:**
- –ù–µ—Ç endpoint `/api/auth/register`
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `/api/users` (—Ç—Ä–µ–±—É–µ—Ç ROOT —Ä–æ–ª—å)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ middleware: –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö

### 5.4. –ó–∞—â–∏—Ç–∞ root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- ROOT –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω —á–µ—Ä–µ–∑ API
- ROOT –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é —Ä–æ–ª—å –Ω–∞ USER
- ROOT –Ω–µ –º–æ–∂–µ—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è
- ROOT –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// –í users.service.ts
async deleteUser(userId: string, currentUser: User) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å ROOT
  const user = await prisma.user.findUnique({ where: { id: userId } });
  if (user?.role === UserRole.ROOT) {
    throw new Error('Cannot delete ROOT user');
  }
  // ...
}
```

### 5.5. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Zod:**
- Email: –≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- Password: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- UUID: –≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è ID
- –†–æ–ª–∏: —Ç–æ–ª—å–∫–æ ROOT –∏–ª–∏ USER

### 5.6. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å argon2id (memoryCost: 65536, timeCost: 3, parallelism: 4)
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏ (–¥–∞–∂–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

### 5.7. JWT Security

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –°–µ–∫—Ä–µ—Ç—ã –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞ (–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤ env.ts)
- –†–∞–∑–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è Access –∏ Refresh —Ç–æ–∫–µ–Ω–æ–≤
- Access token –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π (15 –º–∏–Ω—É—Ç)
- Refresh token —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

### 5.8. CORS

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**
```typescript
// –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:5173',
  credentials: true,  // –î–ª—è CORS (–µ—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è cookies)
}));
```

### 5.9. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å:**
- –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞ (—É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç–∑—ã–≤ refresh —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)

---

## 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 6.1. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ï—Å–ª–∏ ROOT –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
   - –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ `ROOT_EMAIL` –∏ `ROOT_PASSWORD`
   - –•–µ—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ argon2id
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å `ROOT`
3. –ï—Å–ª–∏ ROOT —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// –í src/index.ts –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ src/config/init-root.ts
async function initializeRootUser() {
  const rootExists = await prisma.user.findFirst({
    where: { role: UserRole.ROOT }
  });
  
  if (!rootExists) {
    const passwordHash = await hashPassword(env.ROOT_PASSWORD);
    await prisma.user.create({
      data: {
        email: env.ROOT_EMAIL,
        password: hashedPassword,
        role: UserRole.ROOT,
      }
    });
    logger.info('Root user initialized');
  }
}
```

---

## 7. –¢–∏–ø—ã TypeScript

### 7.1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Express Request

**–§–∞–π–ª: `src/middleware/auth.ts`**

```typescript
export interface AuthenticatedUser {
  id: string;
  email: string;
  role: 'ROOT' | 'USER';
  passwordVersion: number;
}

export interface AuthenticatedRequest extends Request {
  user?: AuthenticatedUser;
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–æ—Å–ª–µ middleware `authMiddleware` –≤ `req.user` –¥–æ—Å—Ç—É–ø–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `req.user` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- `requireAuth` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `req.user`
- `requireRoot` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `req.user.role === 'ROOT'`

### 7.2. JWT Payload —Ç–∏–ø—ã

**–§–∞–π–ª: `src/modules/auth/token.service.ts`**

```typescript
export interface AccessTokenPayload {
  sub: string;              // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  email: string;            // Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  role: 'ROOT' | 'USER';    // –†–æ–ª—å
  passwordVersion: number;  // –í–µ—Ä—Å–∏—è –ø–∞—Ä–æ–ª—è (–¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏)
  type: 'access';
  iat: number;
  exp: number;
}

export interface RefreshTokenPayload {
  sub: string;              // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  tokenId: string;          // UUID refresh token –≤ –ë–î
  passwordVersion: number;  // –í–µ—Ä—Å–∏—è –ø–∞—Ä–æ–ª—è (–¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏)
  type: 'refresh';
  iat: number;
  exp: number;
}
```

---

## 8. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### 8.1. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

```json
{
  "dependencies": {
    "jsonwebtoken": "^9.0.2",        // JWT —Ç–æ–∫–µ–Ω—ã
    "argon2": "^0.44.0",             // –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (argon2id)
    "zod": "^3.24.1",                // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º
    "dotenv-safe": "^9.1.0",         // –í–∞–ª–∏–¥–∞—Ü–∏—è env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    "@prisma/client": "6.18.0",      // Prisma ORM
    "express-rate-limit": "^8.2.1",  // Rate limiting
    "helmet": "^8.1.0",              // Security headers
    "cors": "^2.8.5"                 // CORS
  },
  "devDependencies": {
    "@types/jsonwebtoken": "^9.0.10",
    "@types/argon2": "^0.14.1",
    "@types/cors": "^2.8.19",
    "jest": "^30.2.0",               // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    "supertest": "^7.1.4",           // HTTP —Ç–µ—Å—Ç—ã
    "ts-jest": "^29.4.5"             // TypeScript –¥–ª—è Jest
  }
}
```

---

## 9. –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ (`modules/auth`, `modules/users`, `common`)
2. –°–æ–∑–¥–∞—Ç—å enum `UserRole`
3. –û–±–Ω–æ–≤–∏—Ç—å Prisma schema
4. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –≠—Ç–∞–ø 2: –û–±—â–∏–µ –º–æ–¥—É–ª–∏
1. –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã (`auth.types.ts`)
2. –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã (`password.util.ts`)
3. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`auth.constants.ts`)

### –≠—Ç–∞–ø 3: Auth –º–æ–¥—É–ª—å
1. –°–æ–∑–¥–∞—Ç—å `token.service.ts` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è JWT)
2. –°–æ–∑–¥–∞—Ç—å `auth.service.ts` (–ª–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞)
3. –°–æ–∑–¥–∞—Ç—å middleware `authenticate.ts`
4. –°–æ–∑–¥–∞—Ç—å middleware `authorize.ts`
5. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ routes
6. –°–æ–∑–¥–∞—Ç—å Zod —Å—Ö–µ–º—ã

### –≠—Ç–∞–ø 4: Users –º–æ–¥—É–ª—å
1. –°–æ–∑–¥–∞—Ç—å `users.service.ts` (CRUD —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
2. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ routes
3. –°–æ–∑–¥–∞—Ç—å Zod —Å—Ö–µ–º—ã

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å routes –≤ –≥–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting
3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## 11. Frontend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 11.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ frontend

```
frontend/src/
‚îú‚îÄ‚îÄ components/           # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ AuthProvider.tsx  # Auth Context Provider (auto-login/logout)
‚îÇ   ‚îú‚îÄ‚îÄ ProtectedRoute.tsx # –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
‚îÇ   ‚îú‚îÄ‚îÄ RootRoute.tsx     # –ú–∞—Ä—à—Ä—É—Ç –¥–ª—è ROOT (—Ç—Ä–µ–±—É–µ—Ç ROOT —Ä–æ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ PublicRoute.tsx   # –ü—É–±–ª–∏—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç (—Ä–µ–¥–∏—Ä–µ–∫—Ç –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ hooks/                # React Query —Ö—É–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts        # useLogin, useLogout, useCurrentUser, useRefresh
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ store/                # Zustand store
‚îÇ   ‚îú‚îÄ‚îÄ authStore.ts      # Auth state (user, tokens, selectors)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ utils/                # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ api.ts            # API client (login, logout, refresh, getCurrentUser)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ pages/                # –°—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx     # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ UsersAdminPage.tsx # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (ROOT)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ schemas/              # Zod —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ auth.schema.ts    # –°—Ö–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îî‚îÄ‚îÄ types/                # TypeScript —Ç–∏–ø—ã
    ‚îî‚îÄ‚îÄ index.ts
```

### 11.2. API Client (`utils/api.ts`)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `login(credentials)` - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `logout(refreshToken)` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `refresh(refreshToken)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- `getCurrentUser(accessToken?)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `handleResponse()`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ auth store –ø—Ä–∏ 401 –æ—à–∏–±–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` –ø—Ä–∏ 401 –æ—à–∏–±–∫–µ
- `accessToken` –≤—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ `Authorization: Bearer <token>` header

### 11.3. Auth Store (`store/authStore.ts`)

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `user` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User | null)
- `accessToken` - Access —Ç–æ–∫–µ–Ω (string | null)
- `refreshToken` - Refresh —Ç–æ–∫–µ–Ω (string | null)

**–≠–∫—à–µ–Ω—ã:**
- `setAuth(accessToken, refreshToken, user)` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `clearAuth()` - –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `updateUser(user)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `updateTokens(accessToken, refreshToken)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

**–°–µ–ª–µ–∫—Ç–æ—Ä—ã (computed):**
- `useIsAuthenticated()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (!!accessToken && !!user)
- `useIsRoot()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ ROOT —Ä–æ–ª–∏ (user?.role === 'ROOT')

**Persistence:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `persist` middleware –∏–∑ Zustand
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω—ã –≤ localStorage (–∫–ª—é—á: `auth-storage`)
- User –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —Ä–∏—Å–∫–∞—Ö XSS –≤ localStorage
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∑–∞—â–∏—Ç–µ –æ—Ç XSS –∞—Ç–∞–∫
- –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –±—É–¥—É—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ httpOnly cookies

### 11.4. React Query —Ö—É–∫–∏ (`hooks/useAuth.ts`)

**–•—É–∫–∏:**
- `useLogin()` - mutation –¥–ª—è –≤—Ö–æ–¥–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ store)
- `useLogout()` - mutation –¥–ª—è –≤—ã—Ö–æ–¥–∞ (–æ—á–∏—â–∞–µ—Ç store –∏ React Query cache)
- `useCurrentUser()` - query –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refetch)
- `useRefresh()` - mutation –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (–æ–±–Ω–æ–≤–ª—è–µ—Ç store)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zustand store
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ React Query cache
- –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ logout

### 11.5. Auth Provider (`components/AuthProvider.tsx`)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ auth store –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ `App.tsx`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useCurrentUser()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 11.6. Route Protection

**ProtectedRoute:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `isAuthenticated`
- –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/login` –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –†–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**RootRoute:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `isAuthenticated` –∏ `isRoot`
- –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/login` –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/` –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ –Ω–µ ROOT
- –†–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**PublicRoute:**
- –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/` –µ—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –≤—Ö–æ–¥–∞ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞)

### 11.7. Login Page (`pages/LoginPage.tsx`)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- React Hook Form + Zod –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- MUI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è UI
- –û–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ (—á–µ—Ä–µ–∑ PublicRoute)

### 11.8. Security —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Frontend)

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage (—Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º —Ä–∏—Å–∫–æ–≤ XSS)
- ‚úÖ accessToken –≤—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ `Authorization: Bearer <token>` header
- ‚úÖ –ü—Ä–∏ –ª—é–±–æ–º 401 - –æ—á–∏—â–∞–µ—Ç auth store –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/login`
- ‚úÖ –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ROOT:**
- UI –ø–æ–ª—è disabled –¥–ª—è ROOT –≤ `EditUserDialog`
- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫—Ä—ã—Ç–∞ –¥–ª—è ROOT –≤ `UserTable`
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `onSubmit` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

---

## 12. –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### Backend:
- [ ] –í—Å–µ JWT —Å–µ–∫—Ä–µ—Ç—ã –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
- [ ] JWT_ACCESS_SECRET ‚â† JWT_REFRESH_SECRET
- [ ] ROOT_PASSWORD —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (–º–∏–Ω. 12 —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–≥–ª–∞–≤–Ω—ã–µ/—Å—Ç—Ä–æ—á–Ω—ã–µ, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
- [ ] Access token –∂–∏–≤–µ—Ç ‚â§ 1 —á–∞—Å–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 15 –º–∏–Ω—É—Ç)
- [ ] Refresh token –∂–∏–≤–µ—Ç –¥–æ–ª—å—à–µ Access token (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 7 –¥–Ω–µ–π)
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è `/api/auth/login` (5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç)
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ `*`, —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ origins)
- [ ] ROOT –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω/–∏–∑–º–µ–Ω–µ–Ω —á–µ—Ä–µ–∑ API
- [ ] –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å ROOT —á–µ—Ä–µ–∑ API
- [ ] –ù–µ—Ç endpoint –¥–ª—è —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ argon2id (–Ω–µ bcrypt)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π/—Ç–æ–∫–µ–Ω–æ–≤)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod
- [ ] –†–æ—Ç–∞—Ü–∏—è refresh —Ç–æ–∫–µ–Ω–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è (passwordVersion)
- [ ] Helmet.js –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

### Frontend:
- [ ] –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage (—Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º —Ä–∏—Å–∫–æ–≤ XSS - —Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ)
- [ ] accessToken –≤—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ `Authorization: Bearer <token>` header
- [ ] –ü—Ä–∏ –ª—é–±–æ–º 401 - –æ—á–∏—â–∞–µ—Ç auth store –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/login`
- [ ] –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- [ ] –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (UI + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ onSubmit)
- [ ] ProtectedRoute –∏ RootRoute –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] AuthProvider –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (JWT, rate limiting, –∑–∞—â–∏—Ç–∞ root)
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (TypeScript + Zod)
- ‚úÖ –£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è SPA (React + React Query + Zustand)
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ best practices

**Backend:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø–æ–∫—Ä—ã—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.  
**Frontend:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –∑–∞—â–∏—Ç–æ–π –º–∞—Ä—à—Ä—É—Ç–æ–≤.

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

