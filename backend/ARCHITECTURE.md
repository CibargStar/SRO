# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Node.js 20, TypeScript 5.9, Express 5, Prisma 6.

**–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ù–µ—Ç —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ root —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –î–≤–µ —Ä–æ–ª–∏: ROOT (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä) –∏ USER (–æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- Root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ root

---

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π –∏ –ø–∞–ø–æ–∫

### 1.1. –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/src/
‚îú‚îÄ‚îÄ modules/                    # –ë–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ auth/                   # –ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/        # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (request/response)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts      # –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ token.service.ts     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è JWT
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/         # Auth middleware
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authenticate.ts      # –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authorize.ts          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π (RBAC)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/             # Express –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/            # Zod —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.schemas.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts            # –ü—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ users/                  # –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ       ‚îú‚îÄ‚îÄ controllers/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ users.controller.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ       ‚îú‚îÄ‚îÄ services/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ users.service.ts      # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è root)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ       ‚îú‚îÄ‚îÄ routes/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ users.routes.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ       ‚îú‚îÄ‚îÄ schemas/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ users.schemas.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ
‚îú‚îÄ‚îÄ common/                     # –û–±—â–∏–µ –º–æ–¥—É–ª–∏ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ enums/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user-role.enum.ts   # Enum —Ä–æ–ª–µ–π (ROOT, USER)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.constants.ts   # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Ç.–¥.)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.types.ts       # –¢–∏–ø—ã –¥–ª—è JWT payload, Request extensions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ password.util.ts    # –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ
‚îú‚îÄ‚îÄ middleware/                # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ middleware (—Ä–∞—Å—à–∏—Ä–∏—Ç—å)
‚îÇ   ‚îú‚îÄ‚îÄ rate-limit/            # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ rate limiters
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth-rate-limit.ts  # –°—Ç—Ä–æ–≥–∏–π –ª–∏–º–∏—Ç –¥–ª—è /auth/login
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îî‚îÄ‚îÄ ...                    # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ middleware
‚îÇ
‚îú‚îÄ‚îÄ config/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
‚îú‚îÄ‚îÄ routes/                    # –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç –º–æ–¥—É–ª–∏)
‚îî‚îÄ‚îÄ index.ts                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

### 1.2. –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:**
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å (auth, users) —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- –ú–æ–¥—É–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–π API —á–µ—Ä–µ–∑ `index.ts`
- –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è —Å–∫—Ä—ã—Ç–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- **Controllers** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Services** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ Prisma
- **Routes** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ Express
- **Schemas** - Zod —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **Middleware** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–û–±—â–∏–µ –º–æ–¥—É–ª–∏ (common):**
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–æ–¥—É–ª—è–º–∏
- –ù–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –¢–∏–ø—ã, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, —É—Ç–∏–ª–∏—Ç—ã, enums

---

## 2. –°—É—â–Ω–æ—Å—Ç–∏ –∏ —Ä–æ–ª–∏

### 2.1. Prisma Schema

```prisma
// –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
enum UserRole {
  ROOT  // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ env)
  USER  // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Å–æ–∑–¥–∞–µ—Ç—Å—è root'–æ–º)
}

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String    // –•–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å (bcrypt)
  role      UserRole  @default(USER)
  name      String?   // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏–º—è
  isActive  Boolean   @default(true)  // –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω root'–æ–º
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  // –°–≤—è–∑—å —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏
  refreshTokens RefreshToken[]
  
  @@index([email])
  @@index([role])
}

// Refresh —Ç–æ–∫–µ–Ω (–¥–ª—è –æ—Ç–∑—ã–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤)
model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique  // JWT refresh token
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([expiresAt])  // –î–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
}
```

### 2.2. Enum —Ä–æ–ª–µ–π

**–§–∞–π–ª: `src/common/enums/user-role.enum.ts`**

```typescript
/**
 * –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ
 */
export enum UserRole {
  ROOT = 'ROOT',  // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã
  USER = 'USER',  // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –í Prisma schema (enum)
- –í TypeScript —Ç–∏–ø–∞—Ö
- –í middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### 2.3. –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞

| –î–µ–π—Å—Ç–≤–∏–µ | ROOT | USER |
|----------|------|------|
| –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É | ‚úÖ | ‚úÖ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è | ‚úÖ | ‚úÖ |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è | ‚ùå | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚úÖ | ‚ùå |
| –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |
| –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |
| –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ | ‚ùå |

**–í–∞–∂–Ω–æ:**
- ROOT –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é —Ä–æ–ª—å –Ω–∞ USER
- ROOT –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–µ–±—è
- ROOT –Ω–µ –º–æ–∂–µ—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è
- USER –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–ª—å–∫–æ ROOT)

---

## 3. –°—Ö–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT)

### 3.1. –¢–∏–ø—ã —Ç–æ–∫–µ–Ω–æ–≤

#### Access Token (–∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π)
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 15 –º–∏–Ω—É—Ç (–∏–∑ `JWT_ACCESS_EXPIRES_IN`)
- **Payload:**
  ```typescript
  {
    userId: string;      // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    role: UserRole;       // ROOT –∏–ª–∏ USER
    type: 'access';      // –¢–∏–ø —Ç–æ–∫–µ–Ω–∞
    iat: number;         // –í—Ä–µ–º—è –≤—ã–¥–∞—á–∏
    exp: number;         // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
  }
  ```
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í –ø–∞–º—è—Ç–∏ React (—á–µ—Ä–µ–∑ React Query/Zustand) –∏–ª–∏ localStorage
- **–ü–µ—Ä–µ–¥–∞—á–∞:** –í HTTP –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º API endpoints

#### Refresh Token (–¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π)
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 7 –¥–Ω–µ–π (–∏–∑ `JWT_REFRESH_EXPIRES_IN`)
- **Payload:**
  ```typescript
  {
    userId: string;      // UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    tokenId: string;     // UUID refresh —Ç–æ–∫–µ–Ω–∞ –≤ –ë–î (–¥–ª—è –æ—Ç–∑—ã–≤–∞)
    type: 'refresh';      // –¢–∏–ø —Ç–æ–∫–µ–Ω–∞
    iat: number;         // –í—Ä–µ–º—è –≤—ã–¥–∞—á–∏
    exp: number;         // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
  }
  ```
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í httpOnly cookie (`refreshToken`)
- **–ü–µ—Ä–µ–¥–∞—á–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∫–∞–∂–¥—ã–º HTTP –∑–∞–ø—Ä–æ—Å–æ–º
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–∞ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞

### 3.2. –†–µ—à–µ–Ω–∏–µ: Cookie vs Header

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**

| –¢–æ–∫–µ–Ω | –•—Ä–∞–Ω–µ–Ω–∏–µ | –ü–µ—Ä–µ–¥–∞—á–∞ | –ü—Ä–∏—á–∏–Ω–∞ |
|-------|----------|----------|---------|
| **Access Token** | –ü–∞–º—è—Ç—å/localStorage | `Authorization` header | –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø, –ª–µ–≥–∫–æ –æ—Ç–æ–∑–≤–∞—Ç—å |
| **Refresh Token** | httpOnly cookie | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | –ó–∞—â–∏—Ç–∞ –æ—Ç XSS, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ |

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Access token –≤ header - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –ª–µ–≥–∫–æ –æ—Ç–æ–∑–≤–∞—Ç—å
- Refresh token –≤ httpOnly cookie - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS –∞—Ç–∞–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ refresh token —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
- –£–¥–æ–±–Ω–æ –¥–ª—è SPA (React)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ cookie –¥–ª—è refresh token:**
```typescript
{
  httpOnly: true,        // –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ JavaScript (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
  secure: true,         // –¢–æ–ª—å–∫–æ HTTPS (–≤ production)
  sameSite: 'strict',   // –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
  maxAge: 7 * 24 * 60 * 60 * 1000,  // 7 –¥–Ω–µ–π –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
  path: '/api/auth',    // –¢–æ–ª—å–∫–æ –¥–ª—è auth endpoints
}
```

### 3.3. Flow –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```
1. –í—Ö–æ–¥ (POST /api/auth/login)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ email/password
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Access Token (15 –º–∏–Ω)
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Refresh Token (7 –¥–Ω–µ–π)
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Refresh Token –≤ –ë–î
   ‚îú‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Refresh Token –≤ httpOnly cookie
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç Access Token –≤ response body

2. –ó–∞–ø—Ä–æ—Å –∫ API (GET /api/users)
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Access Token –∏–∑ Authorization header
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è Access Token
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (middleware)
   ‚îî‚îÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞

3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (POST /api/auth/refresh)
   ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Refresh Token –∏–∑ cookie
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è Refresh Token
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤ –ë–î (–Ω–µ –æ—Ç–æ–∑–≤–∞–Ω)
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ Access Token
   ‚îú‚îÄ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ä–æ—Ç–∞—Ü–∏—è Refresh Token
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç –Ω–æ–≤–æ–≥–æ Access Token

4. –í—ã—Ö–æ–¥ (POST /api/auth/logout)
   ‚îú‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ Refresh Token –∏–∑ –ë–î
   ‚îî‚îÄ –û—á–∏—Å—Ç–∫–∞ cookie
```

---

## 4. API Endpoints

### 4.1. Auth Endpoints

```
POST   /api/auth/login          # –í—Ö–æ–¥ (email, password) ‚Üí { accessToken, user }
POST   /api/auth/logout         # –í—ã—Ö–æ–¥ (—Ç—Ä–µ–±—É–µ—Ç auth) ‚Üí 204
POST   /api/auth/refresh        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token ‚Üí { accessToken }
GET    /api/auth/me             # –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ç—Ä–µ–±—É–µ—Ç auth) ‚Üí { user }
```

### 4.2. Users Endpoints (—Ç–æ–ª—å–∫–æ –¥–ª—è ROOT)

```
GET    /api/users               # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { users[] }
GET    /api/users/:id           # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ ID (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { user }
POST   /api/users               # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { user }
PATCH  /api/users/:id            # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { user }
DELETE /api/users/:id           # –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí 204
PATCH  /api/users/:id/activate  # –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç ROOT) ‚Üí { user }
```

---

## 5. Security-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

### 5.1. Rate Limiting

**–û–±—â–∏–π rate limiter (—É–∂–µ –µ—Å—Ç—å):**
- 100 –∑–∞–ø—Ä–æ—Å–æ–≤ / 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP

**–°—Ç—Ä–æ–≥–∏–π rate limiter –¥–ª—è `/api/auth/login`:**
- 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP
- –ó–∞—â–∏—Ç–∞ –æ—Ç brute force –∞—Ç–∞–∫
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429 Too Many Requests

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// src/middleware/rate-limit/auth-rate-limit.ts
export const authRateLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,  // 15 –º–∏–Ω—É—Ç
  max: 5,                     // 5 –ø–æ–ø—ã—Ç–æ–∫
  message: 'Too many login attempts, please try again later.',
  standardHeaders: true,
  legacyHeaders: false,
});
```

### 5.2. –ó–∞—â–∏—Ç–∞ –æ—Ç brute force

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (—É—Å–ø–µ—à–Ω—ã—Ö –∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP –ø–æ—Å–ª–µ 10 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ 1 —á–∞—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ Redis)
- CAPTCHA –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 5.3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç:**
- –ù–µ—Ç endpoint `/api/auth/register`
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `/api/users` (—Ç—Ä–µ–±—É–µ—Ç ROOT —Ä–æ–ª—å)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ middleware: –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö

### 5.4. –ó–∞—â–∏—Ç–∞ root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- ROOT –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω —á–µ—Ä–µ–∑ API
- ROOT –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é —Ä–æ–ª—å –Ω–∞ USER
- ROOT –Ω–µ –º–æ–∂–µ—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è
- ROOT –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// –í users.service.ts
async deleteUser(userId: string, currentUser: User) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å ROOT
  const user = await prisma.user.findUnique({ where: { id: userId } });
  if (user?.role === UserRole.ROOT) {
    throw new Error('Cannot delete ROOT user');
  }
  // ...
}
```

### 5.5. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Zod:**
- Email: –≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- Password: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- UUID: –≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è ID
- –†–æ–ª–∏: —Ç–æ–ª—å–∫–æ ROOT –∏–ª–∏ USER

### 5.6. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bcrypt —Å cost factor 12+
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏ (–¥–∞–∂–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

### 5.7. JWT Security

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –°–µ–∫—Ä–µ—Ç—ã –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞ (–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤ env.ts)
- –†–∞–∑–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è Access –∏ Refresh —Ç–æ–∫–µ–Ω–æ–≤
- Access token –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π (15 –º–∏–Ω—É—Ç)
- Refresh token —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

### 5.8. CORS

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**
```typescript
// –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:5173',
  credentials: true,  // –î–ª—è httpOnly cookies
}));
```

### 5.9. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å:**
- –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞ (—É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç–∑—ã–≤ refresh —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)

---

## 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 6.1. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ ROOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ï—Å–ª–∏ ROOT –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
   - –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ `ROOT_EMAIL` –∏ `ROOT_PASSWORD`
   - –•–µ—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ bcrypt
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å `ROOT`
3. –ï—Å–ª–∏ ROOT —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// –í src/index.ts –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ src/config/init-root.ts
async function initializeRootUser() {
  const rootExists = await prisma.user.findFirst({
    where: { role: UserRole.ROOT }
  });
  
  if (!rootExists) {
    const hashedPassword = await bcrypt.hash(env.ROOT_PASSWORD, 12);
    await prisma.user.create({
      data: {
        email: env.ROOT_EMAIL,
        password: hashedPassword,
        role: UserRole.ROOT,
      }
    });
    logger.info('Root user initialized');
  }
}
```

---

## 7. –¢–∏–ø—ã TypeScript

### 7.1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Express Request

**–§–∞–π–ª: `src/common/types/auth.types.ts`**

```typescript
import { UserRole } from '../enums/user-role.enum';

declare global {
  namespace Express {
    interface Request {
      user?: {
        id: string;
        role: UserRole;
        email: string;
      };
    }
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–æ—Å–ª–µ middleware `authenticate` –≤ `req.user` –¥–æ—Å—Ç—É–ø–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `req.user` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

### 7.2. JWT Payload —Ç–∏–ø—ã

```typescript
export interface AccessTokenPayload {
  userId: string;
  role: UserRole;
  type: 'access';
  iat: number;
  exp: number;
}

export interface RefreshTokenPayload {
  userId: string;
  tokenId: string;  // UUID refresh token –≤ –ë–î
  type: 'refresh';
  iat: number;
  exp: number;
}
```

---

## 8. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### 8.1. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

```json
{
  "dependencies": {
    "jsonwebtoken": "^9.0.0",        // JWT —Ç–æ–∫–µ–Ω—ã
    "bcrypt": "^5.1.0",              // –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
    "cookie-parser": "^1.4.6"        // –ü–∞—Ä—Å–∏–Ω–≥ cookies
  },
  "devDependencies": {
    "@types/jsonwebtoken": "^9.0.0",
    "@types/bcrypt": "^5.0.0",
    "@types/cookie-parser": "^1.4.6"
  }
}
```

---

## 9. –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ (`modules/auth`, `modules/users`, `common`)
2. –°–æ–∑–¥–∞—Ç—å enum `UserRole`
3. –û–±–Ω–æ–≤–∏—Ç—å Prisma schema
4. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –≠—Ç–∞–ø 2: –û–±—â–∏–µ –º–æ–¥—É–ª–∏
1. –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã (`auth.types.ts`)
2. –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã (`password.util.ts`)
3. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`auth.constants.ts`)

### –≠—Ç–∞–ø 3: Auth –º–æ–¥—É–ª—å
1. –°–æ–∑–¥–∞—Ç—å `token.service.ts` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è JWT)
2. –°–æ–∑–¥–∞—Ç—å `auth.service.ts` (–ª–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞)
3. –°–æ–∑–¥–∞—Ç—å middleware `authenticate.ts`
4. –°–æ–∑–¥–∞—Ç—å middleware `authorize.ts`
5. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ routes
6. –°–æ–∑–¥–∞—Ç—å Zod —Å—Ö–µ–º—ã

### –≠—Ç–∞–ø 4: Users –º–æ–¥—É–ª—å
1. –°–æ–∑–¥–∞—Ç—å `users.service.ts` (CRUD —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
2. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ routes
3. –°–æ–∑–¥–∞—Ç—å Zod —Å—Ö–µ–º—ã

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å routes –≤ –≥–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting
3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## 10. –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- [ ] –í—Å–µ JWT —Å–µ–∫—Ä–µ—Ç—ã –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
- [ ] JWT_ACCESS_SECRET ‚â† JWT_REFRESH_SECRET
- [ ] ROOT_PASSWORD —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- [ ] Access token –∂–∏–≤–µ—Ç ‚â§ 1 —á–∞—Å–∞
- [ ] Refresh token –∂–∏–≤–µ—Ç –¥–æ–ª—å—à–µ Access token
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è `/api/auth/login`
- [ ] httpOnly cookie –¥–ª—è refresh token
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] ROOT –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω/–∏–∑–º–µ–Ω–µ–Ω
- [ ] –ù–µ—Ç endpoint –¥–ª—è —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ bcrypt
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (JWT, rate limiting, –∑–∞—â–∏—Ç–∞ root)
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (TypeScript + Zod)
- ‚úÖ –£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è SPA (React + React Query)
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ best practices

–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! üöÄ

